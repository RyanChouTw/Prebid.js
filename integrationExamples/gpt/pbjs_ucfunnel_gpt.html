<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel="icon" type="image/png" href="/favicon.png">
  <!-- Prebid Config Section START -->
  <!-- Make sure this is inserted before your GPT tag -->
  <script async src="//www.googletagservices.com/tag/js/gpt.js"></script>
  <script async src="/build/dev/prebid.js"></script>

  <!-- use recent version of videojs to ensure proper functioning with the iOS devices -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/video.js/6.4.0/video-js.css">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/video.js/6.4.0/video.js"></script>
  <!-- videojs-vast-vpaid -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/videojs-vast-vpaid/2.0.2/videojs.vast.vpaid.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-vast-vpaid/2.0.2/videojs_5.vast.vpaid.min.js"></script>

  <script>
    var googletag = googletag || {};
    googletag.cmd = googletag.cmd || [];

    var pbjs = pbjs || {};
    pbjs.que = pbjs.que || [];
    var PREBID_TIMEOUT = 3000;

    var date = new Date().getTime();
    function initAdserver() {
      if (pbjs.initAdserverSet) return;

      googletag.cmd.push(function() {
        pbjs.que.push(function() {
          pbjs.setTargetingForGPTAsync();
          googletag.pubads().refresh();
        });
      });

      pbjs.initAdserverSet = true;
    }

    // Load GPT when timeout is reached.
    setTimeout(initAdserver, PREBID_TIMEOUT);

    pbjs.que.push(function() {
      pbjs.setConfig({
        debug: true,
        cache: {
          url: 'https://prebid.adnxs.com/pbc/v1/cache'
        }
      });

      var allSlotsBidWon = function allSlotsBidWon() {
        console.log('allSlotsBidWon called');
      };

      pbjs.onEvent('bidWon', allSlotsBidWon);

      var adUnits = [
        {
          code: 'div-gpt-ad-1495530934718-0',
          sizes: [[300, 250]],
          bids: [{
              bidder: 'ucfunnel',
              params: {
                adid: "test-ad-34BBD2AA24B678BBFD4E7B9EE3B872D"
              }
            }
          ]
        },
        {
          code: '/18087395/PrebidTest/PrebidNativeTest1',
          sizes: [
            [1, 1]
          ],
          mediaTypes: {
            native: {
            title: {
              required: true
            },
            body: {
              required: true
            },
            image: {
              required: true
            },
            sponsoredBy: {
              required: true
            },
            icon: {
              required: false
            },
          }
          },
          bids: [{
            bidder: 'ucfunnel',
            params: {
              adid: 'test-ad-627736446B2BD3A60E8AEABDB7BD833E',
            }
          }]
        }
      ];

      var videoAdUnit = {
        code: 'video1',
        mediaTypes: {
          video: {
            playerSize: [640, 360],
            context: 'instream'
          }
        },
        bids: [{
          bidder: 'ucfunnel',
          params: {
            adid: 'test-ad-9A22D466494297EAC443D967B2622DA9',
          }
        }]
      };

      pbjs.addAdUnits(adUnits);
      pbjs.requestBids({
        bidsBackHandler: function(bidResponses) {
          initAdserver();
        }
      });
      pbjs.addAdUnits(videoAdUnit);
      pbjs.requestBids({
        bidsBackHandler: function(bids) {
          var videoUrl = pbjs.adServers.dfp.buildVideoUrl({
            adUnit: videoAdUnit,
            params: {
              iu: '/18087395/PrebidTest/PrebidVideoTest1',
              output: 'vast'
            }
          });
          invokeVideoPlayer(videoUrl);
        }
      });

    });
  </script>
  <!-- Prebid Config Section END -->
  <script>
      googletag.cmd.push(function() {
        googletag.defineSlot('/18087395/header-bid-tag-0', [300, 250], 'div-gpt-ad-1495530934718-0').addService(googletag.pubads());
        googletag.pubads().enableSingleRequest();
        googletag.enableServices();
      });

      // GPT setup
      googletag.cmd.push(function() {
        var slot2 = googletag.defineSlot('/18087395/PrebidTest/PrebidNativeTest1', 'fluid', 'div-2').addService(googletag.pubads());
        googletag.pubads().disableInitialLoad();
        googletag.pubads().enableSingleRequest();
        googletag.enableServices();
      });
  </script>
</head>
<body>


  <h2>Prebid.js Banner</h2>
  <!-- /18087395/header-bid-tag-0 -->
  <div id='div-gpt-ad-1495530934718-0'>
    <script>
        googletag.cmd.push(function() { googletag.display('div-gpt-ad-1495530934718-0'); });
    </script>
  </div>

  <h2>Prebid Native</h2>
  <div id='div-2'>
      <p>No response</p>
      <script type='text/javascript'>
          googletag.cmd.push(function() {
              googletag.display('div-2');
          });

      </script>
  </div>


  <h2>Prebid Video -- video.js</h2>
  <div class="example-video-container">
    <video id="vid1" class="video-js vjs-default-skin vjs-big-play-centered" controls data-setup='{}' width='640' height='480'>
      <source src="http://vjs.zencdn.net/v/oceans.mp4" type='video/mp4'/>
      <source src="http://vjs.zencdn.net/v/oceans.webm" type='video/webm'/>
      <source src="http://vjs.zencdn.net/v/oceans.ogv" type='video/ogg'/>
    </video>
  </div>

  <script>
    var page_load_time;

    page_load_time = new Date().getTime() - performance.timing.navigationStart;
    console.log(page_load_time + "ms -- Player loading!");

    var vid1 = videojs('vid1');

    page_load_time = new Date().getTime() - performance.timing.navigationStart;
    console.log(page_load_time + "ms -- Player loaded!");

    function invokeVideoPlayer(url) {

      page_load_time = new Date().getTime() - performance.timing.navigationStart;
      console.log(page_load_time + "ms -- Prebid VAST url = " + url);

      /* Access the player instance by calling `videojs()` and passing
         in the player's ID. Add a `ready` listener to make sure the
         player is ready before interacting with it. */

      videojs("vid1").ready(function() {
        page_load_time = new Date().getTime() - performance.timing.navigationStart;
        console.log(page_load_time + "ms -- Player is ready!");

        /* PASS SETTINGS TO VAST PLUGIN

           Pass in a JSON object to the player's `vastClient` (defined
           by the VAST/VPAID plugin we're using). The requires an
           `adTagUrl`, which will be the URL returned by Prebid. You
           can view all the options available for the `vastClient`
           here:

           https://github.com/MailOnline/videojs-vast-vpaid#options */

          var player = this;
          var vastAd = player.vastClient({
            adTagUrl: url,
            playAdAlways: true,
            verbosity: 4,
            vpaidFlashLoaderPath: "https://github.com/MailOnline/videojs-vast-vpaid/blob/RELEASE/bin/VPAIDFlash.swf?raw=true",
            autoplay: true
          });

          page_load_time = new Date().getTime() - performance.timing.navigationStart;
          console.log(page_load_time + "ms -- Prebid VAST tag inserted!");

          player.muted(true);
          player.play();

          page_load_time = new Date().getTime() - performance.timing.navigationStart;
          console.log(page_load_time + "ms -- invokeVideoPlayer complete!");
      });
    }
  </script>
</body>
</html>
